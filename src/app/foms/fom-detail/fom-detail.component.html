<div class="top-container">
  <div class="container" *ngIf="project">
    <div class="title-container">
      <div class="title-container__title">
        <h1>FOM ID: {{project.id}}</h1>
      </div>
      <div class="title-container__actions">
        <div class="btn-container">
          <!-- <button class="btn btn-light" type="button" title="Edit application"
            [routerLink]="['/a', project.id, 'edit']"
            [disabled]="application.meta.isRetired">
            Edit
          </button> -->
          <button class="btn btn-light" type="button" title="Edit FOM"
                  [routerLink]="['/a', project.id, 'edit']"
                  [disabled]="isDeleting">
            Edit
          </button>
          <span title="You cannot edit a finalized/expired project"></span>
        </div>
        <div class="btn-container">
          <button class="btn btn-primary ml-1" type="button" title="Publish FOM">
            <i class="spinner rotating" [hidden]="!isPublishing"></i>
            <span>{{isPublishing ? 'Publishing' : 'Publish'}}</span>
          </button>
          <!-- <button class="btn btn-primary ml-1" type="button" title="Publish application"
            *ngIf="!application.meta.isPublished"
            (click)="publishApplication()"
            [disabled]="isPublishing || application.meta.isRetired">
            <i class="spinner rotating" [hidden]="!isPublishing"></i>
            <span>{{isPublishing ? 'Publishing' : 'Publish'}}</span>
          </button> -->
          <span title="You cannot publish a retired application"></span>
        </div>
        <!-- NB: you CAN unpublish a retired application -->
        <!-- <button class="btn btn-primary ml-1" type="button" title="Unpublish application">
          <i class="spinner rotating" [hidden]="!isUnpublishing"></i>
          <span>{{isUnpublishing ? 'Unpublishing' : 'Unpublish'}}</span>
        </button> -->
        <!-- <button class="btn btn-primary ml-1" type="button" title="Unpublish application"
          *ngIf="application.meta.isPublished"
          (click)="unPublishApplication()"
          [disabled]="isUnpublishing">
          <i class="spinner rotating" [hidden]="!isUnpublishing"></i>
          <span>{{isUnpublishing ? 'Unpublishing' : 'Unpublish'}}</span>
        </button> -->
        <span class="vert-pipe first-pipe">&nbsp;</span>
        <!-- <button class="btn btn-icon" title="Refresh this FOM"
          (click)="refreshApplication()"
          [disabled]="isRefreshing">
          <i class="material-icons refresh-spinner" [ngClass]="{'rotating': isRefreshing}" [inlineSVG]="'assets/images/baseline-refresh-24px.svg'">
          </i>
        </button> -->
        <button class="btn btn-icon" title="Refresh this FOM">
          <i class="material-icons refresh-spinner" [ngClass]="{'rotating': isRefreshing}"
             [inlineSVG]="'assets/images/baseline-refresh-24px.svg'">
          </i>
        </button>
        <span class="vert-pipe" *ngIf="canWithdraw()">&nbsp;</span>
        <button class="btn btn-icon" title="Remove this FOM"
                *ngIf="canWithdraw()"
                (click)="deleteFOM()"
                [disabled]="isDeleting">
          <i class="spinner-border" [hidden]="!isDeleting"></i>
          <i class="material-icons" [hidden]="isDeleting" >
            delete
          </i>
        </button>
      </div>
    </div>
  </div>
</div>

<div class="bottom-container">
  <div class="container">
    <div class="row">
      <div class="col-md-8">
        <section class="main-card">
          <!-- Tabs -->
          <ul ngbNav #nav="ngbNav" class="nav-tabs">
            <li ngbNavItem [disabled]="isDeleting">
              <a ngbNavLink>
                <i class="material-icons">
                  info
                </i>
                FOM Information
              </a>
              <ng-template ngbNavContent>
                <section>
                  <h2>Name</h2>
                  <p class="mb-0"
                     [innerHTML]="project.name ? (project.name | titlecase) : '<em>No applicant on this file</em>'"></p>
                </section>
                <section>
                  <h2>Description</h2>
                  <p class="mb-0"
                     [innerHTML]="(project.description | newlines | linkify) || '<em>No project description available</em>'"></p>
                </section>
                <section>
                  <h2>Details</h2>
                  <ul class="nv-list">
                    <li>
                      <span class="name">FOM Holder:</span>
                      <span
                        class="value">
<!--                        class="value">{{project.forestClient ? project.forestClient.name : 'No applicant on this file'}}-->
                        {{project.forestClient.name}}
                      </span>
                    </li>
                    <li>
                      <span class="name">District:</span>
                      <span
                        class="value">
                        {{project.district ? project.district?.name : 'A district has not been specified'}}
<!--                        {{district ? district.name : ' - '}}-->
                      </span>
                    </li>
                    <!-- <li>
                      <span class="name">Total Area (hectares):</span>
                      <span class="value">{{application.areaHectares ? (application.areaHectares | number:'1.2-2') : '-'}}</span>
                    </li> -->
                    <!-- <li *ngIf="application.publishDate">
                      <span class="name">Initial Publish Date:</span>
                      <span class="value">{{application.publishDate | date:'longDate'}}</span>
                    </li> -->
                  </ul>
                </section>
                <section *ngIf="attachments.length > 0">
                  <h2>Attachments</h2>
                  <div class="doc-list" style="width: 25rem;">
                    <a class="doc-list__item"
                       *ngFor="let attachment of attachments"
                       [href]="getAttachmentUrl(attachment.id)"
                       [title]="attachment.fileName || ''"
                       target="_blank" rel="noopener">
                      <div class="cell doc-list__item-icon">
                        <i class="material-icons">
                          <!-- insert_drive_file -->
                        </i>
                      </div>
                      <div class="cell doc-list__item-name">{{attachment.fileName}}</div>
                      <div style="text-align: right;margin-right: 5px;">({{attachment.attachmentType.description}})</div>
                    </a>
                  </div>
                </section>
              </ng-template>
            </li>
            <li ngbNavItem [disabled]="isDeleting">

              <a ngbNavLink>
                <i class="material-icons">
                  pin_drop
                </i>
                Location
              </a>

              <ng-template ngbNavContent>
                <h2>Geographic Shape Information</h2>

                  <app-details-map
                    [projectSpatialDetail]="spatialDetail">
                  </app-details-map>

                  <app-shape-info
                    [spatialDetail]="spatialDetail">
                  </app-shape-info>

              </ng-template>

            </li>
          </ul>
          <div [ngbNavOutlet]="nav"></div>
        </section>
      </div>

      <div class="col-md-4">
        <div class="aside-card">
          <h3 class="title">Application Status</h3>
          <div class="body">
            <div
              class="app-status">
<!--              {{project.workflowState && project.workflowStateCode ? project.workflowStateCode: '-'}}-->
              {{project.workflowState ? project.workflowState.code: '-'}}
            </div>
          </div>
        </div>

        <div class="aside-card">
          <h3 class="title">Comment Period Details</h3>
          <!-- <div class="body" *ngIf="!application.meta.currentPeriod">
            Not Open For Commenting
          </div> -->
          <!-- <div class="body" *ngIf="application.meta.currentPeriod"> -->
          <div class="body">
            <ul class="nv-list">
              <li>
                <span class="name">Status:</span>
                <span class="value">
<!--                  {{project.workflowState && project.workflowState?.description}}-->
                </span>
              </li>
              <li>
                <span class="name">Start Date:</span>
                <span class="value">{{project.commentingOpenDate | date:'longDate'}}</span>
              </li>
              <li>
                <span class="name">End Date:</span>
                <span class="value">{{project.commentingClosedDate| date:'longDate'}}</span>
              </li>
              <!-- <li *ngIf="application.meta.currentPeriod.meta.daysRemaining">
                <span class="name">Days Remaining:</span>
                <span class="value">{{application.meta.currentPeriod.meta.daysRemaining}}</span>
              </li> -->
              <li>
                <span class="name">Days Remaining:</span>
                <span class="value">Some days in the future TBD</span>
              </li>
            </ul>
            <div class="btn-container" *ngIf="project">
              <button class="cta-btn btn btn-sm btn-outline-primary" type="button" title="Review comments"
                      [disabled]="isDeleting"
                      [routerLink]="['/comments', project.id]">
                Review Comments<span>&nbsp;({{numberComments}})</span>
              </button>
            </div>
          </div>
        </div>
        <div class="aside-card">
          <h3 class="title">FOM Attachments</h3>
          <div class="body">
            <!-- <div *ngIf="!application.meta.decision">
              <p class="mb-0">No decision documents have been added to this application.</p>
            </div> -->
            <div>Attachment file goes here</div>
            <div>
              <ul class="doc-list">
                <li *ngFor="let doc of (project['attachments'] || [])">
                  <span class="cell icon">
                    <!--<i class="material-icons link" (click)="api.openDocument(doc)">
                      insert_drive_file
                    </i>-->
                  </span>
                  <span class="cell name" [title]="doc.displayName || ''">
                      <!--<span class="cell__txt-content">
                        <a (click)="api.openDocument(doc)">{{doc.documentFileName}}</a>
                      </span>-->
                  </span>
                  <span class="cell actions">
                    <!--<button class="btn btn-icon" title="Download this document" (click)="api.downloadDocument(doc)">
                      <i class="material-icons">file_download</i>
                    </button>-->
                  </span>
                </li>
                <li class="no-results" *ngIf="(project['attachments'] || []) === 0">
                  <em>No decision documents</em>
                </li>
              </ul>
            </div>
            <div class="btn-container">
              <button class="cta-btn btn btn-sm btn-outline-primary" type="button" title="Edit fom documents"
                      [disabled]="isDeleting"
                      [routerLink]="['/a', project.id, 'edit']">
                Edit FOM Attachments
              </button>
              <span title="You cannot edit the decision of a retired application"></span>
            </div>
          </div>
        </div>
        <div class="aside-card">
          <h3 class="title">FOM Spatial Upload</h3>
          <div class="body">
            <!-- <div *ngIf="!application.meta.decision">
              <p class="mb-0">No decision documents have been added to this application.</p>
            </div> -->
           <div class="btn-container">
              <button class="cta-btn btn btn-sm btn-outline-primary" type="button" title="Edit fom documents"
                      [disabled]="isDeleting"
                      [routerLink]="['/a', project.id, 'upload']">
                Upload FOM Spatial File
              </button>
              <span title="You cannot edit the decision of a retired application"></span>
            </div>
          </div>

        </div>
    </div>
  </div>
</div>
</div>
